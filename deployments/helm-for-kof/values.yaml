replicaCount: 1

image:
  repository: ghcr.io/mirantis/finops-agent
  pullPolicy: Always
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

service:
  type: ClusterIP
  port: 8081
  targetPort: metrics
  name: metrics

resources: {}

nodeSelector: {}

tolerations: []

affinity: {}

# Configuration for the finops-agent
config:
  # Agent configuration
  agent:
    interval: 50000  # seconds between forecast updates
  # Collector configuration
  collector:
    type: prometheus
    url: http://kof-mothership-promxy.kof.svc.cluster.local:8082
    lookback_days: 14
    step: "1h"  # Consistent step size for all queries
    disable_ssl: true
    timeout: 300
    max_retries: 3
    chunk_days: 0.25  # 6 hours for better granular processing

  # Model configuration
  models:
    type: toto
    forecast_horizon: 7 # number of days ahead in future
    quantiles: [0.1, 0.5, 0.9]
    toto:
      checkpoint: Datadog/Toto-Open-Base-1.0
      device: cpu              # or gpu
      context_length: 4096
      num_samples: 256
      compile: true

  # Optimizer configuration
  optimizer:
    idle_cpu_threshold: 0.3
    idle_mem_threshold: 0.3
    min_node_savings: 1

  # Validation configuration
  validation:
    enabled: true
    interval_cycles: 2  # Run validation every 2 forecast cycles
    train_ratio: 0.7    # Use 70% for training, 30% for testing
    log_level: INFO

  # Metrics configuration
  metrics:
    forecast_api_port: 8081
    forecast_api_host: "0.0.0.0"

  # Node normalization configuration
  node_normalization:
    enabled: True
    kube_node_info_query: "kube_node_info"  # Query to get node mappings
    fallback_to_original: True  # Return original name if no mapping found
    log_mapping_stats: True  # Log mapping statistics for debugging


# Grafana
grafana:
  enabled: true
  # GrafanaDasboard Namespace has to be the same as the kof GrafanaDashboards Namespace
  dashboardNamespace: "kof"  # Namespace for GrafanaDashboard CRD
  dashboardLabels:                     # Labels for GrafanaDashboard CRD
    app: grafana
  dashboardFolder: "General"   # kof-grafana-dashboard default folder
  # Note: Grafana Infinity plugin v3.4.1 must be manually installed
  # in the KOF Grafana instance for dashboards to work properly

# Optional: install Grafana Operator via subchart
grafanaOperator:
  enabled: true